# HNG DevOps-Stage-4-Infrastructure
### Overview
This repository contains the Infrastructure as Code (IaC) and configuration management setup for deploying an application on an AWS EC2 instance. The application, originally containerized at [Part 1](https://github.com/azayyad48/DevOps-Stage-4), includes a Vue.js frontend, Go-based Auth API, Node.js Todos API, Java/Spring Boot Users API, Python Log Message Processor, and Redis Queue, all orchestrated with Docker Compose and secured via Traefik as a reverse proxy. This Part 2 implementation uses Terraform to provision the infrastructure and Ansible to configure and deploy the application, achieving a fully automated single-command deployment with terraform apply -auto-approve.
### The deployed application is accessible at:
* Frontend: https://devahmed.xyz

- Auth API: https://auth.devahmed.xyz

- Todos API: https://todos.devahmed.xyz

- Users API: https://users.devahmed.xyz

## Project Structure
```
DevOps-Stage-4-Infrastructure/
├── terraform/
│   ├── main.tf
│   ├── variables.tf
│   ├── outputs.tf
│   
└── ansible/
    ├── playbook.yml
    ├── inventory.yml (generated by Terraform)
    └── roles/
        ├── dependencies/
        │   └── tasks/
        │       └── main.yml
        └── deployment/
            └── tasks/
                └── main.yml
```

### Requirements
To replicate this setup, ensure you have the following tools and prerequisites installed and configured on your local machine (e.g., a MacBook):
Software
- AWS CLI:
- Terraform:
- Ansible:
- Git:
- Docker (locally optional, required on EC2):
Used by Ansible to deploy containers on the EC2 instance.

### Prerequisites
1. **AWS Account**:
   - Permissions: Ability to create EC2 instances, Elastic IPs, and Security Groups.
   - Region: Set to `us-east-1` (or your preferred region, adjustable in `variables.tf`).

2. **SSH Key Pair**:
   - Generate: `ssh-keygen -t rsa -b 4096 -f ~/.ssh/new-key -C "DevOps-Stage-4 key"`.
   - Files: `~/.ssh/new-key` (private), `~/.ssh/new-key.pub` (public).
   - No passphrase recommended for automation (or manage it securely).

3. **Forked Application Repository**:
   - URL: [https://github.com/azayyad48/DevOps-Stage-4.git](https://github.com/azayyad48/DevOps-Stage-4.git).


4. **Domain**:
   - Your registrar or Domain
   - Configured post-deployment with the EC2’s Elastic IP.

## Setup Instructions
Follow these steps to deploy the infrastructure and application from your local machine.

### Step 1: Clone the Infrastructure Repository
1. **Clone**:
   ```bash
   git clone https://github.com/azayyad48/stage4-infra.git
   cd stage4-infra

- This clones the infrastructure repository.

2. **Verify Directory Structure**:

```
ls -l
```
Should see terraform/ and ansible/ directories.

### Step 2: Configure Terraform

1. **Navigate to Terraform Directory**
```
cd terraform
```
2. **Update variables.tf (if needed)**

3. **Deploy with Terraform**
```
terraform init
```
### Step3: Deploy with Terraform

1. **Run Single Command**:
```
terraform apply -auto-approve
```
- Duration: Approximately 5-10 minutes.
- Actions:

     - Provisions an EC2 instance (t2.small, Ubuntu 24.04).

    -   Configures a security group (ports 22, 80, 443, 8088 open).

    -   Generates ansible/inventory.yml.

    -    Triggers Ansible to install dependencies and deploy the app.

### Step4: Verify Deployment

1. SSH In:

```
ssh -i /Users/user/.ssh/new-key ubuntu@<your-ip>
```
2. Check Containers:
```
cd ~/DevOps-Stage-4
docker-compose ps
```
- Should list traefik, frontend, auth-api, etc., as Up.








